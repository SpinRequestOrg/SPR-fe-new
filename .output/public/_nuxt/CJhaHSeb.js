import{A as ie,_ as de}from"./BYY8zWWn.js";import{_ as le}from"./BGYjoraW.js";import{_ as T,a as re}from"./D0wfAQm_.js";import{e as J,h as R,r as D,l as ue,f as pe,o as l,c as v,m as e,b as s,L as V,q as b,a as t,F as C,Q as F,d as k,t as f,w as a,_ as h,s as Q,n as q,R as K,S as W,y as ce,O as I,X,U as me,V as fe,W as _e,Y as Z,Z as ee,$ as te,k as se,j as U,J as ge,K as ve,M as ye,N as he}from"./CvmUOF0K.js";import{_ as qe}from"./DFpnTQmO.js";import{_ as xe}from"./1oisvJoa.js";import{_ as N}from"./BBS-zHhX.js";import{_ as ne}from"./Cdy6G670.js";import{_ as B,e as j}from"./yscacLTq.js";import{u as A}from"./DT-s2yDi.js";import{C as be}from"./COp1Kciz.js";import{D as Y}from"./CG_RSgCJ.js";import{u as $e}from"./BC3Jz7u_.js";import{a as we,u as ke}from"./CXtZsCVx.js";import{u as Re}from"./DUDgB96_.js";import"./CMLxWDVT.js";import"./D4BgpJvF.js";import"./x_dMzJ3U.js";/**
 * @license lucide-vue-next v0.447.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=J("CheckIcon",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-vue-next v0.447.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=J("RefreshCcwIcon",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]),Ce={class:"w-full border rounded-3xl bg-white/5 px-6 py-4 relative"},ze={key:0,class:"absolute inset-0 grid place-items-center bg-background/65 rounded-[inherit] z-10"},Ee={class:"space-y-6 my-8"},Le={class:"text-lg text-muted-foreground capitalize min-w-fit"},Se=R({__name:"event-rate-card",props:{services:{},onUpdate:{type:Function}},setup(x){const m=x,i=D(!1),c=D([]);ue(()=>m.services,u=>{c.value=u},{immediate:!0});const{$repo:{event:_}}=pe(),r=async(u,n)=>await _.updateEventPrice(u,n),d=async()=>{var u;try{i.value=!0;const n=await Promise.all(c.value.map(o=>r(o.id,o.price)));i.value=!1,Q({title:"Prices updated"})}catch(n){i.value=!1,Q({title:((u=n==null?void 0:n.data)==null?void 0:u.message)??"Failed to update prices",variant:"warning"}),console.error("FAILED TO UPDATE PRICES",n)}};return(u,n)=>(l(),v("div",Ce,[e(i)?(l(),v("div",ze,[s(e(V),{class:"size-5 animate-spin"})])):b("",!0),n[5]||(n[5]=t("div",{class:"text-2xl font-medium"},"Live prices",-1)),t("div",Ee,[(l(!0),v(C,null,F(e(c),o=>(l(),v("div",{class:"flex justify-between items-center",key:o.id},[t("div",Le,[k(f(o.name)+" ",1),n[0]||(n[0]=t("span",{class:"hidden md:inline"},"request",-1))]),s(qe,{modelValue:o.price,"onUpdate:modelValue":y=>o.price=y,id:`PRICE-FOR-${o.name}-${o.id}`,step:100},null,8,["modelValue","onUpdate:modelValue","id"]),b("",!0)]))),128))]),s(h,{class:"w-full",onClick:d},{default:a(()=>n[4]||(n[4]=[k("Update price")])),_:1})]))}}),Ae={class:"space-y-1 text-left"},De={class:"font-medium"},Ne={class:"text-sm text-muted-foreground"},Me={class:"py-4 mt-4 border-t border-t-white/5"},Te={class:"flex gap-x-2"},Ve={class:"space-y-1 w-full"},Fe={class:"text-white/80"},Ie={class:"space-y-1 w-full"},Be={class:"tabular-nums text-white/80"},je={key:0,class:"flex gap-x-4 mt-8"},Pe={key:1,class:"py-1 px-6 bg-foreground text-background text-center text-sm mt-8 rounded-3xl animate-pulse"},Oe=R({__name:"request-collapsible-item",props:{request:{},index:{},onUpdate:{},defaultOpen:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},setup(x){const m=x,i=D(m.defaultOpen),c=D(!1),{updateEventRequest:_,update_status:r,updating:d}=A(),u=()=>{m.disabled||c.value||(i.value=!i.value)},n=o=>{_(m.request.id,o,m.onUpdate)};return(o,y)=>{const z=me,E=fe,L=_e;return l(),q(L,{class:"bg-white/5 rounded-2xl",open:e(i),disabled:o.disabled},{default:a(()=>[s(z,{class:"grid grid-cols-[auto_1fr_auto] gap-x-4 w-full items-center justify-start relative px-4 sm:px-6 py-3 [&[data-state='open']_.caret]:rotate-180",onClick:u},{default:a(()=>{var g;return[t("div",{class:K(("cn"in o?o.cn:e(W))(o.request.status==="now-playing"?"text-primary text-base font-medium":"text-foreground"))},f(o.index??"-"),3),t("div",Ae,[o.request.type==="hype"?(l(),q(B,{key:0,content:(g=o.request)==null?void 0:g.description,modelValue:e(c),"onUpdate:modelValue":y[0]||(y[0]=p=>ce(c)?c.value=p:null)},null,8,["content","modelValue"])):(l(),v(C,{key:1},[t("div",De,f(o.request.song_title),1),t("div",Ne," by "+f(o.request.artist),1)],64))]),s(e(be),{class:"size-5 caret transition-transform relative"})]}),_:1}),s(E,{class:"data-[state=open]:animate-collapsibleSlideDown data-[state=closed]:animate-collapsibleSlideUp overflow-hidden px-4 sm:px-6"},{default:a(()=>[t("div",Me,[t("div",Te,[t("div",Ve,[y[2]||(y[2]=t("div",{class:"text-sm text-muted-foreground"},"Requested by",-1)),t("div",Fe,f(o.request.nickname??o.request.audience.name),1)]),t("div",Ie,[y[3]||(y[3]=t("div",{class:"text-sm text-muted-foreground"},"Amount paid",-1)),t("div",Be," ₦"+f(("formatMoney"in o?o.formatMoney:e(I))(o.request.price)),1)])]),o.request.status==="new"?(l(),v("div",je,[s(h,{class:"w-full",disabled:e(d),loading:e(d)&&e(r)==="now-playing",onClick:y[1]||(y[1]=g=>n("now-playing"))},{default:a(()=>[y[4]||(y[4]=k(" Accept ")),s(e(ae),{class:"size-4 ml-2"})]),_:1},8,["disabled","loading"]),s(T,{onConfirm:()=>n("declined")},{default:a(()=>[s(h,{variant:"secondary",class:"w-full !border-destructive !text-destructive",disabled:e(d),loading:e(d)&&e(r)==="declined"},{default:a(()=>[y[5]||(y[5]=k(" Reject ")),s(e(X),{class:"size-4 ml-2"})]),_:1},8,["disabled","loading"])]),_:1},8,["onConfirm"])])):o.request.status==="now-playing"?(l(),v("div",Pe," Now "+f(o.request.type==="hype"?"performing hype":"playing"),1)):b("",!0)])]),_:1})]),_:1},8,["open","disabled"])}}}),He={class:"grid grid-cols-request-line-item gap-x-4 items-center px-2 sm:px-6 py-4 bg-white/5 rounded-2xl"},Qe={class:"space-y-1"},Ye={class:"font-medium"},Ge={class:"text-sm text-muted-foreground"},Je={class:"space-y-1"},Ke={class:"text-white/80"},We={class:"space-y-1"},Xe={class:"tabular-nums text-white/80"},Ze={key:0,class:"flex gap-x-2 justify-self-end"},et={key:1,class:"py-1 px-6 bg-foreground text-background text-center text-sm rounded-2xl animate-pulse justify-self-end"},tt=R({__name:"request-line-item",props:{request:{},index:{},onUpdate:{type:Function}},setup(x){const m=x,{updateEventRequest:i,update_status:c,updating:_}=A(),r=d=>{i(m.request.id,d,m.onUpdate)};return(d,u)=>{var n;return l(),v("div",He,[t("div",{class:K(("cn"in d?d.cn:e(W))(d.request.status==="now-playing"?"text-primary text-base font-medium":"text-foreground"))},f(d.index??"-"),3),t("div",Qe,[d.request.type==="hype"?(l(),q(B,{key:0,content:(n=d.request)==null?void 0:n.description},null,8,["content"])):(l(),v(C,{key:1},[t("div",Ye,f(d.request.song_title),1),t("div",Ge,"by "+f(d.request.artist),1)],64))]),t("div",Je,[u[1]||(u[1]=t("div",{class:"text-sm text-muted-foreground"},"Requested by",-1)),t("div",Ke,f(d.request.nickname??d.request.audience.name),1)]),t("div",We,[u[2]||(u[2]=t("div",{class:"text-sm text-muted-foreground"},"Amount paid",-1)),t("div",Xe," ₦"+f(("formatMoney"in d?d.formatMoney:e(I))(d.request.price)),1)]),d.request.status==="new"?(l(),v("div",Ze,[s(h,{onClick:u[0]||(u[0]=o=>r("now-playing")),disabled:e(_),loading:e(_)&&e(c)==="now-playing"},{default:a(()=>[u[3]||(u[3]=k(" Accept ")),s(e(ae),{class:"size-3 ml-2"})]),_:1},8,["disabled","loading"]),s(T,{onConfirm:()=>r("declined"),message:"Are you sure you want to reject this request?"},{default:a(()=>[s(h,{variant:"secondary",disabled:e(_),loading:e(_)&&e(c)==="declined",class:"!border-destructive !text-destructive"},{default:a(()=>[u[4]||(u[4]=k(" Reject ")),s(e(X),{class:"size-3 ml-2"})]),_:1},8,["disabled","loading"])]),_:1},8,["onConfirm"])])):d.request.status==="now-playing"?(l(),v("div",et," Now "+f(d.request.type==="hype"?"performing hype":"playing"),1)):b("",!0)])}}}),st={key:0,class:"min-h-[350px]"},nt={class:"place-center grid place-items-center gap-2"},at={class:"size-12 rounded-full bg-white/40 relative"},ot={class:"text-xl text-muted-foreground font-medium"},G=R({__name:"request-list",props:{requests:{default:()=>j},onUpdate:{},type:{default:"song"},loading:{type:Boolean,default:!1}},setup(x){const m=i=>{i.preventDefault()};return(i,c)=>{const _=Z,r=N,d=ee,u=te;return l(),q(u,null,{default:a(()=>[s(d,{class:"space-y-2 relative"},{default:a(()=>[(l(!0),v(C,null,F(i.requests,(n,o)=>(l(),q(_,{key:n.id,value:n.id,onSelect:m},{default:a(()=>[s(Oe,{request:n,class:"min-[880px]:hidden",index:o+1,onUpdate:i.onUpdate,"default-open":n.status==="now-playing",disabled:n.status==="now-playing"},null,8,["request","index","onUpdate","default-open","disabled"]),s(tt,{request:n,class:"hidden min-[880px]:grid",index:o+1,onUpdate:i.onUpdate},null,8,["request","index","onUpdate"])]),_:2},1032,["value"]))),128)),!i.requests.length&&!i.loading?(l(),v("div",st,[t("div",nt,[t("div",at,[s(r,{class:"scale-75 place-center",name:i.type=="song"?"music":"mic"},null,8,["name"])]),t("div",ot," No "+f(i.type)+" requests ",1),c[0]||(c[0]=t("div",{class:"text-muted-foreground"}," Get prepared, requests may come soon ",-1))])])):b("",!0)]),_:1})]),_:1})}}}),it={class:"grid md:grid-cols-[70px_1fr] gap-2 px-2 sm:px-6 py-4 b-white/5 rounded-2xl text-muted-foreground"},dt={class:"grid md:grid-cols-[1fr_200px] gap-2 items-center"},lt={class:"space-y-1"},rt={class:"flex gap-x-2 items-center"},ut={class:"text-base text-foreground font-medium"},pt={class:"text-sm"},ct={class:"flex gap-x- items-center"},mt={class:"flex items-center gap-x-1"},ft={class:"uppercase"},_t={class:"tabular-nums"},gt={class:"flex gap-x-1 md:justify-end items-center text-sm"},vt={class:"capitalize"},yt=R({__name:"request-history-line-item",props:{request:{},index:{},onUpdate:{type:Function}},setup(x){const m=x,{updateEventRequest:i,updating:c}=A(),_=r=>{i(m.request.id,r,m.onUpdate)};return(r,d)=>{const u=N,n=h;return l(),v("div",it,[t("div",null,f(("useDateFormat"in r?r.useDateFormat:e($e))(new Date(r.request.created_at),"h:mma")),1),t("div",dt,[t("div",lt,[t("div",rt,[r.request.type==="hype"?(l(),q(B,{key:0,content:r.request.description,class:"text-base text-foreground font-medium"},null,8,["content"])):(l(),v(C,{key:1},[t("div",ut,f(r.request.song_title),1),t("div",pt,"by "+f(r.request.artist),1)],64))]),t("div",ct,[t("div",null,f(r.request.nickname??r.request.audience.name),1),s(e(Y)),t("div",mt,[s(u,{class:"scale-50",name:r.request.type=="song"?"music":"mic"},null,8,["name"]),t("div",ft,f(r.request.type),1)]),s(e(Y)),t("div",_t,"₦"+f(("formatMoney"in r?r.formatMoney:e(I))(r.request.price)),1)])]),t("div",gt,[t("div",vt,f(r.request.status),1),["ignored","declined"].includes(r.request.status)?(l(),q(ne,{key:0,message:"Return to request list",delay:200},{default:a(()=>[s(n,{size:"icon",variant:"ghost",disabled:e(c),loading:e(c),onClick:d[0]||(d[0]=()=>_("new"))},{default:a(()=>[s(e(Ue),{class:"text-muted-foreground size-4"})]),_:1},8,["disabled","loading"])]),_:1})):b("",!0)])])])}}}),ht={key:0,class:"min-h-[350px]"},qt={class:"place-center grid place-items-center gap-2 text-center"},xt={class:"size-12 rounded-full bg-white/40 relative"},bt=R({__name:"request-history-list",props:{requests:{default:()=>j},onUpdate:{},loading:{type:Boolean,default:!1}},setup(x){const m=i=>{i.preventDefault()};return(i,c)=>{const _=Z,r=N,d=ee,u=te;return l(),q(u,null,{default:a(()=>[s(d,{class:"space-y-2 relative"},{default:a(()=>[(l(!0),v(C,null,F(i.requests,n=>(l(),q(_,{key:n.id,value:n.id,onSelect:m},{default:a(()=>[s(yt,{request:n,onUpdate:i.onUpdate},null,8,["request","onUpdate"])]),_:2},1032,["value"]))),128)),!i.requests.length&&!i.loading?(l(),v("div",ht,[t("div",qt,[t("div",xt,[s(r,{class:"scale-75 place-center",name:"history"})]),c[0]||(c[0]=t("div",{class:"text-xl text-muted-foreground font-medium"}," Nothing yet ",-1)),c[1]||(c[1]=t("div",{class:"text-muted-foreground"}," Your completed/rejected requests will be here ",-1))])])):b("",!0)]),_:1})]),_:1})}}}),$t={class:"size-5 text-sm bg-secondary text-destructive rounded-full font-semibold count"},wt={class:"size-5 text-sm bg-secondary text-destructive rounded-full font-semibold count"},kt={class:"md:hidden"},Rt={key:2,class:"py-8 absolute inset-0 bg-white/5 rounded-[inherit] grid place-items-center z-10"},Ut={key:1,class:"grid place-items-center gap-y-4"},Ct={class:"text-destructive text-center"},zt=R({__name:"requests-tab",props:{requests:{default:()=>j},event_id:{default:"1"}},setup(x){const m=x,i=se(),c=U(()=>{var g;return(g=i==null?void 0:i.query)==null?void 0:g.request_tab}),_=U(()=>c.value??"song"),{fetchEventRequests:r}=A(),{data:d,status:u,error:n,refresh:o}=we(`EVENT-${m.event_id}-REQUESTS`,()=>r(m.event_id),{transform:g=>{const p={"now-playing":0,new:1,"payment-pending":2,completed:3,declined:4,ignored:5};return g.data.sort(($,w)=>(p==null?void 0:p[$.status])-p[w.status])}}),y=U(()=>{var g;return!d.value||n.value?[]:(g=d.value)==null?void 0:g.filter(p=>p.status==="new"||p.status==="now-playing")}),z=U(()=>{var g;return!d.value||n.value?[]:(g=d.value)==null?void 0:g.filter(p=>p.status!=="new"&&p.status!=="now-playing")}),E=U(()=>y.value.filter(g=>g.type==="song")),L=U(()=>y.value.filter(g=>g.type==="hype"));return(g,p)=>{const $=xe,w=ge,S=ve,P=N,M=ye,oe=he;return l(),q(oe,{class:"border bg-white/5 rounded-3xl relative","default-value":e(_)},{default:a(()=>{var O,H;return[e(_)==="history"?(l(),q(S,{key:0,class:"p-4 border-b grid grid-cols-[auto_1fr] gap-x-4 items-center min-h-[73px] transition-opacity duration-1000"},{default:a(()=>[p[2]||(p[2]=t("div",{class:"text-lg font-medium pl-6 hidden md:block"},"Request history",-1)),s(w,{value:"song","as-child":""},{default:a(()=>[s($,{replace:"",to:{query:{...e(i).query,request_tab:"song"}},class:"flex items-center gap-x-1 ml-auto pr-6"},{default:a(()=>[s(h,{variant:"outline",size:"icon"},{default:a(()=>[s(e(ie))]),_:1}),p[1]||(p[1]=t("div",null,"Back to live request",-1))]),_:1},8,["to"])]),_:1})]),_:1})):(l(),q(S,{key:1,class:"p-4 border-b grid grid-cols-[auto_auto_1fr] gap-x-4 items-center -z-10"},{default:a(()=>[s(w,{value:"song","as-child":""},{default:a(()=>[s($,{replace:"",to:{query:{...e(i).query,request_tab:"song"}},class:"[&[data-state='active']_.count]:hidden"},{default:a(()=>[s(h,{variant:e(_)==="song"?"primary":"outline",class:"gap-x-2 md:min-w-[100px]"},{default:a(()=>[p[3]||(p[3]=t("div",null,"song",-1)),t("div",$t,f(e(E).length),1)]),_:1},8,["variant"])]),_:1},8,["to"])]),_:1}),s(w,{value:"hype","as-child":""},{default:a(()=>[s($,{replace:"",to:{query:{...e(i).query,request_tab:"hype"}},class:"[&[data-state='active']_.count]:hidden"},{default:a(()=>[s(h,{variant:e(_)==="hype"?"primary":"outline",class:"gap-x-2 md:min-w-[100px]"},{default:a(()=>[p[4]||(p[4]=t("div",null,"hype",-1)),t("div",wt,f(e(L).length),1)]),_:1},8,["variant"])]),_:1},8,["to"])]),_:1}),s(w,{value:"history","as-child":""},{default:a(()=>[s($,{to:{query:{...e(i).query,request_tab:"history"}},replace:"",class:"ml-auto"},{default:a(()=>[s(h,{variant:"ghost",class:"gap-x-2 text-muted-foreground hidden md:inline-flex"},{default:a(()=>[s(P,{name:"history"}),p[5]||(p[5]=t("div",null,"Request history",-1))]),_:1}),t("div",kt,[s(ne,{message:"Request history"},{default:a(()=>[s(h,{variant:"ghost",size:"icon"},{default:a(()=>[s(P,{name:"history"})]),_:1})]),_:1})])]),_:1},8,["to"])]),_:1})]),_:1})),e(u)=="pending"||e(n)?(l(),v("div",Rt,[e(u)==="pending"?(l(),q(e(V),{key:0,class:"size-5 animate-spin"})):e(n)?(l(),v("div",Ut,[t("div",Ct,f(((H=(O=e(n))==null?void 0:O.data)==null?void 0:H.message)??"Failed to load request"),1),s(h,{variant:"secondary",onClick:p[0]||(p[0]=()=>e(o)())},{default:a(()=>p[6]||(p[6]=[k(" Retry ")])),_:1})])):b("",!0)])):b("",!0),e(n)?b("",!0):(l(),v(C,{key:3},[s(M,{value:"song"},{default:a(()=>[s(G,{type:"song",loading:e(u)==="pending",requests:e(E),onUpdate:e(o),class:"p-4"},null,8,["loading","requests","onUpdate"])]),_:1}),s(M,{value:"hype",class:"p-4"},{default:a(()=>[s(G,{type:"hype",loading:e(u)==="pending",requests:e(L),onUpdate:e(o)},null,8,["loading","requests","onUpdate"])]),_:1}),s(M,{value:"history",class:"p-4"},{default:a(()=>[s(bt,{loading:e(u)==="pending",requests:e(z),onUpdate:e(o)},null,8,["loading","requests","onUpdate"])]),_:1})],64))]}),_:1},8,["default-value"])}}}),Et={class:"container py-20"},Lt={class:"flex items-center gap-x-2"},St={class:"text-foreground font-medium text-lg"},At={class:"grid xl:grid-cols-[1fr_auto] items-start gap-4"},Dt={class:"xl:max-w-[900px]"},Nt={class:"max-w-[700px] mx-auto w-full xl:w-[380px] relative"},Mt={key:0,class:"absolute inset-0 grid place-items-center bg-background/40"},ts=R({__name:"index",setup(x){const m=se(),{endEvent:i,ending:c}=A(),{data:_,error:r,status:d,refresh:u}=ke(`/events/${m.params.id}`),n=()=>{i(m.params.id)},o=U(()=>{var y;return(y=m==null?void 0:m.query)==null?void 0:y.request_tab});return Re({title:()=>o.value==="history"?"Request History":"Song and Hype Request List"}),(y,z)=>{var g,p,$;const E=de,L=le;return l(),v("div",null,[s(re,{ending:e(c),onEndEvent:n,"start-date":(g=e(_))==null?void 0:g.data.start_date,animate:""},null,8,["ending","start-date"]),t("div",Et,[t("div",Lt,[s(E,{to:"/dashboard"}),t("div",St,f(($=(p=e(_))==null?void 0:p.data)==null?void 0:$.title),1)]),s(L,{error:e(r),class:"mt-8"},{default:a(()=>{var w,S;return[t("div",At,[t("div",Dt,[s(zt,{event_id:e(m).params.id},null,8,["event_id"])]),t("div",Nt,[e(d)==="pending"?(l(),v("div",Mt,[s(e(V),{class:"size-5 animate-spin"})])):b("",!0),s(Se,{services:((S=(w=e(_))==null?void 0:w.data)==null?void 0:S.types)??[],onUpdate:e(u)},null,8,["services","onUpdate"]),s(T,{onConfirm:n,message:"Are you sure you want to end this event?"},{default:a(()=>[s(h,{class:"w-full mt-6",variant:"destructive",size:"lg",loading:e(c)},{default:a(()=>z[0]||(z[0]=[k(" END EVENT ")])),_:1},8,["loading"])]),_:1})])])]}),_:1},8,["error"])])])}}});export{ts as default};
