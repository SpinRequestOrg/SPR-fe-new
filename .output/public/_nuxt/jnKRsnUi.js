import{_ as I}from"./Fg1Jie9v.js";import{_ as L}from"./IDfWNahu.js";import{m as $,u as R,r as V,n as q,s as N,p as U,q as j,v as B,x as M,g as W,o as i,c as l,y as t,a,b as o,t as w,d as E,w as p,z as T,_ as C,F as G,L as A}from"./CDWzObpM.js";import{u as H}from"./GBKGAFhY.js";import"./Baf1ulLP.js";/**
 * @license lucide-vue-next v0.447.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=$("CircleCheckIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-vue-next v0.447.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=$("TriangleAlertIcon",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),O=(u,r)=>{const{$repo:{auth:f}}=R(),x=V(null),v=V(null),c=V(!1),m=!!u&&!!r,_=q(r,`/email/verify/${u}/${r}`),{data:z,execute:y,status:g,error:d}=H(_,{immediate:m,lazy:!0});return{authState:z,verifyEmail:y,verificationStatus:g,verificationError:d,resendData:v,resending:c,resendError:x,resendVerificationEmail:async()=>{try{c.value=!0;const n=u?await f.resendEmail(u):null,s=n==null?void 0:n.message;s&&N({title:s}),v.value=n,c.value=!1}catch(n){N({title:"Error",description:"Failed to resend email",variant:"warning"}),c.value=!1,x.value=n}}}},P={class:"h-full container pt-6"},Q={key:0,class:"fixed inset-0 z-10 bg-background grid place-items-center"},X={key:0,class:"relative grid place-items-center gap-2"},Y={key:1,class:"relative grid place-items-center gap-2 w-[700px] max-w-[100vw] mx-auto px-3"},Z={class:"text-2xl md:text-3xl font-semibold text-center"},ee={class:"text-muted-foreground"},te={class:"text-foreground"},se={class:"flex gap-4 mt-4"},ae={key:1},ie={key:2,class:"relative grid place-items-center gap-2 w-[700px] max-w-[100vw] mx-auto px-3"},oe={class:"text-2xl md:text-3xl font-semibold text-center mb-6"},ne={class:"w-[700px] max-w-full mx-auto mt-8 space-y-6"},le={class:"text-muted-foreground text-center"},re={class:"text-foreground"},ce={class:"rounded-xl bg-white/5 p-4 md:p-6 w-[480px] max-w-full mx-auto flex flex-col md:flex-row gap-4 items-center justify-between z-10 relative"},de={key:1},ve=U({__name:"email-confirmation",setup(u){const{authEmail:r,auth_user:f,saveAuthUser:x}=j(),v=B(()=>{var e;return((e=f.value)==null?void 0:e.role)==="host"?"/host/dashboard":"/search"}),c=B(()=>{var s;return(s=f.value)==null?void 0:s.id}),m=M(),_=B(()=>{var s;return(s=m==null?void 0:m.query)==null?void 0:s.email_verify_url}),{verificationStatus:z,verificationError:y,resendVerificationEmail:g,resending:d,verifyEmail:S,authState:n}=O(c.value,_.value);return W(n,s=>{var h,b;const e=(h=s==null?void 0:s.data)==null?void 0:h.user,k=(b=s==null?void 0:s.data)==null?void 0:b.token;e&&k&&x(k,e)},{immediate:!0}),(s,e)=>{var D,F;const k=I,h=L,b=C;return i(),l("div",P,[t(c)&&t(_)?(i(),l("div",Q,[e[4]||(e[4]=a("div",{class:"bg-sp-purple/50 blur-[150px] size-56 absolute"},null,-1)),t(z)=="pending"?(i(),l("div",X,[o(t(A),{class:"size-6 animate-spin"}),e[0]||(e[0]=a("div",{class:"text-base"},"Verifying email",-1))])):t(y)?(i(),l("div",Y,[o(t(K),{class:"size-10 text-destructive"}),a("div",Z,w(((F=(D=t(y))==null?void 0:D.data)==null?void 0:F.message)??"Email verification failed"),1),a("div",ee,[e[1]||(e[1]=E(" Failed to verify ")),a("span",te,w(t(r)),1)]),a("div",se,[o(C,{variant:"secondary",disabled:t(d),onClick:t(g)},{default:p(()=>[t(d)?(i(),T(t(A),{key:0,class:"size-5 animate-spin"})):(i(),l("span",ae,"Resend email"))]),_:1},8,["disabled","onClick"]),o(C,{onClick:t(S)},{default:p(()=>e[2]||(e[2]=[a("span",null,"Try again",-1)])),_:1},8,["onClick"])])])):(i(),l("div",ie,[o(t(J),{class:"size-10 text-primary"}),a("div",oe," Email ("+w(t(r))+") verified ",1),o(k,{to:t(v)},{default:p(()=>[o(C,null,{default:p(()=>e[3]||(e[3]=[E(" Done ")])),_:1})]),_:1},8,["to"])]))])):(i(),l(G,{key:1},[o(h,{to:"/login"}),e[9]||(e[9]=a("div",{class:"bg-sp-purple/50 blur-[200px] size-56 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"},null,-1)),a("div",ne,[e[8]||(e[8]=a("div",{class:"text-4xl md:text-5xl font-semibold text-center"}," Check your inbox to confirm your email address ",-1)),a("div",le,[e[5]||(e[5]=E(" We sent a mail to ")),a("span",re,w(t(r)),1),e[6]||(e[6]=E(" click the link to access your account "))]),a("div",ce,[e[7]||(e[7]=a("div",{class:"text-base"}," Didn't get the mail in your inbox or spam folder? ",-1)),o(b,{variant:"secondary",class:"w-full md:w-auto",disabled:t(d),onClick:t(g)},{default:p(()=>[t(d)?(i(),T(t(A),{key:0,class:"size-5 animate-spin"})):(i(),l("span",de,"Resend"))]),_:1},8,["disabled","onClick"])])])],64))])}}});export{ve as default};
