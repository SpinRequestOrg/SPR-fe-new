import{_ as O}from"./Ccavnmjg.js";import{_ as M}from"./CqOvMmf1.js";import{m as V,n as h,p as G,q as K,s as W,u as I,r as B,v as H,x as U,y as J,z as P,A as Q,g as X,o as d,c as y,B as t,a as r,b as p,t as D,d as T,w as z,C as j,_ as F,F as Y}from"./D5arO9F3.js";import{u as Z}from"./jkZRNiJi.js";import{L}from"./BnxuoDm3.js";import{c as N}from"./B_TM8TBb.js";function ee(n,o,m){const[i={},u]=typeof o=="string"?[{},o]:[o,m],a=V(()=>h(n)),l=i.key||G([u,typeof a.value=="string"?a.value:"",...te(i)]);if(!l||typeof l!="string")throw new TypeError("[nuxt] [useFetch] key must be a string: "+l);if(!n)throw new Error("[nuxt] [useFetch] request is missing.");const x=l===u?"$f"+l:l;if(!i.baseURL&&typeof a.value=="string"&&a.value[0]==="/"&&a.value[1]==="/")throw new Error('[nuxt] [useFetch] the request URL must not start with "//".');const{server:C,lazy:_,default:g,transform:v,pick:$,watch:c,immediate:s,getCachedData:e,deep:b,dedupe:k,...w}=i,E=K({...W,...w,cache:typeof i.cache=="boolean"?void 0:i.cache}),A={server:C,lazy:_,default:g,transform:v,pick:$,immediate:s,getCachedData:e,deep:b,dedupe:k,watch:c===!1?[]:[E,a,...c||[]]};let f;return Z(x,()=>{var S;(S=f==null?void 0:f.abort)==null||S.call(f,"Request aborted as another request to the same endpoint was initiated."),f=typeof AbortController<"u"?new AbortController:{};const R=h(i.timeout);let q;return R&&(q=setTimeout(()=>f.abort("Request aborted due to timeout."),R),f.signal.onabort=()=>clearTimeout(q)),(i.$fetch||globalThis.$fetch)(a.value,{signal:f.signal,...E}).finally(()=>{clearTimeout(q)})},A)}function te(n){var m;const o=[((m=h(n.method))==null?void 0:m.toUpperCase())||"GET",h(n.baseURL)];for(const i of[n.params||n.query]){const u=h(i);if(!u)continue;const a={};for(const[l,x]of Object.entries(u))a[h(l)]=h(x);o.push(a)}return o}/**
 * @license lucide-vue-next v0.447.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=N("CircleCheckIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-vue-next v0.447.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=N("TriangleAlertIcon",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),oe=(n,o={})=>ee(n,{...o,$fetch:I().$api},"$sC22i8rhLA"),ne=(n,o)=>{const{$repo:{auth:m}}=I(),i=B(null),u=B(null),a=B(!1),l=!!n&&!!o,x=H(o,`/email/verify/${n}/${o}`),{data:C,execute:_,status:g,error:v}=oe(x,{immediate:l,lazy:!0});return{authState:C,verifyEmail:_,verificationStatus:g,verificationError:v,resendData:u,resending:a,resendError:i,resendVerificationEmail:async()=>{try{a.value=!0;const c=n?await m.resendEmail(n):null,s=c==null?void 0:c.message;s&&U({title:s}),u.value=c,a.value=!1}catch(c){U({title:"Error",description:"Failed to resend email",variant:"warning"}),a.value=!1,i.value=c}}}},ie={class:"h-full container pt-6"},re={key:0,class:"fixed inset-0 z-10 bg-background grid place-items-center"},le={key:0,class:"relative grid place-items-center gap-2"},ce={key:1,class:"relative grid place-items-center gap-2 w-[700px] max-w-[100vw] mx-auto px-3"},ue={class:"text-2xl md:text-3xl font-semibold text-center"},de={class:"text-muted-foreground"},me={class:"text-foreground"},fe={class:"flex gap-4 mt-4"},pe={key:1},xe={key:2,class:"relative grid place-items-center gap-2 w-[700px] max-w-[100vw] mx-auto px-3"},ve={class:"text-2xl md:text-3xl font-semibold text-center mb-6"},ye={class:"w-[700px] max-w-full mx-auto mt-8 space-y-6"},he={class:"text-muted-foreground text-center"},_e={class:"text-foreground"},ge={class:"rounded-xl bg-white/5 p-4 md:p-6 w-[480px] max-w-full mx-auto flex flex-col md:flex-row gap-4 items-center justify-between z-10 relative"},be={key:1},Te=J({__name:"email-confirmation",setup(n){const{authEmail:o,auth_user:m,saveAuthUser:i}=P(),u=V(()=>{var e;return((e=m.value)==null?void 0:e.role)==="host"?"/host/dashboard":"/search"}),a=V(()=>{var s;return(s=m.value)==null?void 0:s.id}),l=Q(),x=V(()=>{var s;return(s=l==null?void 0:l.query)==null?void 0:s.email_verify_url}),{verificationStatus:C,verificationError:_,resendVerificationEmail:g,resending:v,verifyEmail:$,authState:c}=ne(a.value,x.value);return X(c,s=>{var k,w;const e=(k=s==null?void 0:s.data)==null?void 0:k.user,b=(w=s==null?void 0:s.data)==null?void 0:w.token;e&&b&&i(b,e)},{immediate:!0}),(s,e)=>{var E,A;const b=O,k=M,w=F;return d(),y("div",ie,[t(a)&&t(x)?(d(),y("div",re,[e[4]||(e[4]=r("div",{class:"bg-sp-purple/50 blur-[150px] size-56 absolute"},null,-1)),t(C)=="pending"?(d(),y("div",le,[p(t(L),{class:"size-6 animate-spin"}),e[0]||(e[0]=r("div",{class:"text-base"},"Verifying email",-1))])):t(_)?(d(),y("div",ce,[p(t(ae),{class:"size-10 text-destructive"}),r("div",ue,D(((A=(E=t(_))==null?void 0:E.data)==null?void 0:A.message)??"Email verification failed"),1),r("div",de,[e[1]||(e[1]=T(" Failed to verify ")),r("span",me,D(t(o)),1)]),r("div",fe,[p(F,{variant:"secondary",disabled:t(v),onClick:t(g)},{default:z(()=>[t(v)?(d(),j(t(L),{key:0,class:"size-5 animate-spin"})):(d(),y("span",pe,"Resend email"))]),_:1},8,["disabled","onClick"]),p(F,{onClick:t($)},{default:z(()=>e[2]||(e[2]=[r("span",null,"Try again",-1)])),_:1},8,["onClick"])])])):(d(),y("div",xe,[p(t(se),{class:"size-10 text-primary"}),r("div",ve," Email ("+D(t(o))+") verified ",1),p(b,{to:t(u)},{default:z(()=>[p(F,null,{default:z(()=>e[3]||(e[3]=[T(" Done ")])),_:1})]),_:1},8,["to"])]))])):(d(),y(Y,{key:1},[p(k,{to:"/login"}),e[9]||(e[9]=r("div",{class:"bg-sp-purple/50 blur-[200px] size-56 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"},null,-1)),r("div",ye,[e[8]||(e[8]=r("div",{class:"text-4xl md:text-5xl font-semibold text-center"}," Check your inbox to confirm your email address ",-1)),r("div",he,[e[5]||(e[5]=T(" We sent a mail to ")),r("span",_e,D(t(o)),1),e[6]||(e[6]=T(" click the link to access your account "))]),r("div",ge,[e[7]||(e[7]=r("div",{class:"text-base"}," Didn't get the mail in your inbox or spam folder? ",-1)),p(w,{variant:"secondary",class:"w-full md:w-auto",disabled:t(v),onClick:t(g)},{default:z(()=>[t(v)?(d(),j(t(L),{key:0,class:"size-5 animate-spin"})):(d(),y("span",be,"Resend"))]),_:1},8,["disabled","onClick"])])])],64))])}}});export{Te as default};
