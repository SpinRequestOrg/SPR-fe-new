import{A as ie,_ as de}from"./-_GNoFr9.js";import{_ as le}from"./Dn6XevqU.js";import{_ as V}from"./DJEhMvbj.js";import{e as W,h as U,r as N,l as re,f as ue,o as l,c as g,n as e,b as s,L as B,v as b,a as t,F as E,z as M,d as R,t as f,w as a,_ as h,s as Q,p as q,B as X,C as Z,S as pe,A as F,X as J,T as ce,U as me,V as fe,W as K,Y as ee,Z as te,k as se,j as k,N as _e,O as ge,P as ve,Q as ye,m as he}from"./CNW6Hso0.js";import{_ as qe}from"./DcwoxaP_.js";import{_ as xe}from"./D8FlHw4v.js";import{_ as T}from"./DYqBtWVj.js";import{_ as ne}from"./DA6PwBCs.js";import{_ as j,e as P}from"./ucNmIr38.js";import{u as D}from"./DwHDzuX-.js";import{C as be}from"./D5pFYd-g.js";import{D as Y}from"./CaONRTZ_.js";import{u as we}from"./FtHhDDcH.js";import{a as $e,u as ke}from"./DCLVAHNd.js";import{_ as Re}from"./-HDyGBYI.js";import"./CgIjQpJ9.js";import"./CE7Rug1F.js";import"./CfW5EGt0.js";/**
 * @license lucide-vue-next v0.447.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=W("CheckIcon",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-vue-next v0.447.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=W("RefreshCcwIcon",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]),Ce={class:"w-full border rounded-3xl bg-white/5 px-6 py-4 relative"},ze={key:0,class:"absolute inset-0 grid place-items-center bg-background/65 rounded-[inherit] z-10"},Ee={class:"space-y-6 my-8"},Le={class:"text-lg text-muted-foreground capitalize min-w-fit"},Se=U({__name:"event-rate-card",props:{services:{default:()=>[{id:1,name:"song",price:0},{id:2,name:"hype",price:0}]},onUpdate:{}},setup(x){const m=x,i=N(!1),c=N([]);re(()=>m.services,u=>{c.value=u},{immediate:!0});const{$repo:{event:_}}=ue(),r=async(u,n)=>await _.updateEventPrice(u,n),d=async()=>{var u;try{i.value=!0;const n=await Promise.all(c.value.map(o=>r(o.id,o.price)));i.value=!1,Q({title:"Prices updated"})}catch(n){i.value=!1,Q({title:((u=n==null?void 0:n.data)==null?void 0:u.message)??"Failed to update prices",variant:"warning"}),console.error("FAILED TO UPDATE PRICES",n)}};return(u,n)=>(l(),g("div",Ce,[e(i)?(l(),g("div",ze,[s(e(B),{class:"size-5 animate-spin"})])):b("",!0),n[5]||(n[5]=t("div",{class:"text-2xl font-medium"},"Live prices",-1)),t("div",Ee,[(l(!0),g(E,null,M(e(c),o=>(l(),g("div",{class:"flex justify-between items-center",key:o.id},[t("div",Le,[R(f(o.name)+" ",1),n[0]||(n[0]=t("span",{class:"hidden md:inline"},"request",-1))]),s(qe,{modelValue:o.price,"onUpdate:modelValue":y=>o.price=y,id:`PRICE-FOR-${o.name}-${o.id}`,step:100},null,8,["modelValue","onUpdate:modelValue","id"]),b("",!0)]))),128))]),s(h,{class:"w-full",onClick:d},{default:a(()=>n[4]||(n[4]=[R("Update price")])),_:1})]))}}),Ae={class:"space-y-1 text-left"},De={class:"font-medium"},Ne={class:"text-sm text-muted-foreground"},Te={class:"py-4 mt-4 border-t border-t-white/5"},Ie={class:"flex gap-x-2"},Ve={class:"space-y-1 w-full"},Be={class:"text-white/80"},Me={class:"space-y-1 w-full"},Fe={class:"tabular-nums text-white/80"},je={key:0,class:"flex gap-x-4 mt-8"},Pe={key:1,class:"py-1 px-6 bg-foreground text-background text-center text-sm mt-8 rounded-3xl animate-pulse"},Oe=U({__name:"request-collapsible-item",props:{request:{},index:{},onUpdate:{},defaultOpen:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},setup(x){const m=x,i=N(m.defaultOpen),c=N(!1),{updateEventRequest:_,update_status:r,updating:d}=D(),u=()=>{m.disabled||c.value||(i.value=!i.value)},n=o=>{_(m.request.id,o,m.onUpdate)};return(o,y)=>{const C=ce,z=me,L=fe;return l(),q(L,{class:"bg-white/5 rounded-2xl",open:e(i),disabled:o.disabled},{default:a(()=>[s(C,{class:"grid grid-cols-[auto_1fr_auto] gap-x-4 w-full items-center justify-start relative px-4 sm:px-6 py-3 [&[data-state='open']_.caret]:rotate-180",onClick:u},{default:a(()=>{var v;return[t("div",{class:X(("cn"in o?o.cn:e(Z))(o.request.status==="now-playing"?"text-primary text-base font-medium":"text-foreground"))},f(o.index??"-"),3),t("div",Ae,[o.request.type==="hype"?(l(),q(j,{key:0,content:(v=o.request)==null?void 0:v.description,modelValue:e(c),"onUpdate:modelValue":y[0]||(y[0]=p=>pe(c)?c.value=p:null)},null,8,["content","modelValue"])):(l(),g(E,{key:1},[t("div",De,f(o.request.song_title),1),t("div",Ne," by "+f(o.request.artist),1)],64))]),s(e(be),{class:"size-5 caret transition-transform relative"})]}),_:1}),s(z,{class:"data-[state=open]:animate-collapsibleSlideDown data-[state=closed]:animate-collapsibleSlideUp overflow-hidden px-4 sm:px-6"},{default:a(()=>[t("div",Te,[t("div",Ie,[t("div",Ve,[y[2]||(y[2]=t("div",{class:"text-sm text-muted-foreground"},"Requested by",-1)),t("div",Be,f(o.request.nickname??o.request.audience.name),1)]),t("div",Me,[y[3]||(y[3]=t("div",{class:"text-sm text-muted-foreground"},"Amount paid",-1)),t("div",Fe," ₦"+f(("formatMoney"in o?o.formatMoney:e(F))(o.request.price)),1)])]),o.request.status==="new"?(l(),g("div",je,[s(h,{class:"w-full",disabled:e(d),loading:e(d)&&e(r)==="now-playing",onClick:y[1]||(y[1]=v=>n("now-playing"))},{default:a(()=>[y[4]||(y[4]=R(" Accept ")),s(e(ae),{class:"size-4 ml-2"})]),_:1},8,["disabled","loading"]),s(V,{onConfirm:()=>n("declined")},{default:a(()=>[s(h,{variant:"secondary",class:"w-full !border-destructive !text-destructive",disabled:e(d),loading:e(d)&&e(r)==="declined"},{default:a(()=>[y[5]||(y[5]=R(" Reject ")),s(e(J),{class:"size-4 ml-2"})]),_:1},8,["disabled","loading"])]),_:1},8,["onConfirm"])])):o.request.status==="now-playing"?(l(),g("div",Pe," Now "+f(o.request.type==="hype"?"performing hype":"playing"),1)):b("",!0)])]),_:1})]),_:1},8,["open","disabled"])}}}),He={class:"grid grid-cols-request-line-item gap-x-4 items-center px-2 sm:px-6 py-4 bg-white/5 rounded-2xl"},Qe={class:"space-y-1"},Ye={class:"font-medium"},Ge={class:"text-sm text-muted-foreground"},We={class:"space-y-1"},Xe={class:"text-white/80"},Ze={class:"space-y-1"},Je={class:"tabular-nums text-white/80"},Ke={key:0,class:"flex gap-x-2 justify-self-end"},et={key:1,class:"py-1 px-6 bg-foreground text-background text-center text-sm rounded-2xl animate-pulse justify-self-end"},tt=U({__name:"request-line-item",props:{request:{},index:{},onUpdate:{type:Function}},setup(x){const m=x,{updateEventRequest:i,update_status:c,updating:_}=D(),r=d=>{i(m.request.id,d,m.onUpdate)};return(d,u)=>{var n;return l(),g("div",He,[t("div",{class:X(("cn"in d?d.cn:e(Z))(d.request.status==="now-playing"?"text-primary text-base font-medium":"text-foreground"))},f(d.index??"-"),3),t("div",Qe,[d.request.type==="hype"?(l(),q(j,{key:0,content:(n=d.request)==null?void 0:n.description},null,8,["content"])):(l(),g(E,{key:1},[t("div",Ye,f(d.request.song_title),1),t("div",Ge,"by "+f(d.request.artist),1)],64))]),t("div",We,[u[1]||(u[1]=t("div",{class:"text-sm text-muted-foreground"},"Requested by",-1)),t("div",Xe,f(d.request.nickname??d.request.audience.name),1)]),t("div",Ze,[u[2]||(u[2]=t("div",{class:"text-sm text-muted-foreground"},"Amount paid",-1)),t("div",Je," ₦"+f(("formatMoney"in d?d.formatMoney:e(F))(d.request.price)),1)]),d.request.status==="new"?(l(),g("div",Ke,[s(h,{onClick:u[0]||(u[0]=o=>r("now-playing")),disabled:e(_),loading:e(_)&&e(c)==="now-playing"},{default:a(()=>[u[3]||(u[3]=R(" Accept ")),s(e(ae),{class:"size-3 ml-2"})]),_:1},8,["disabled","loading"]),s(V,{onConfirm:()=>r("declined"),message:"Are you sure you want to reject this request?"},{default:a(()=>[s(h,{variant:"secondary",disabled:e(_),loading:e(_)&&e(c)==="declined",class:"!border-destructive !text-destructive"},{default:a(()=>[u[4]||(u[4]=R(" Reject ")),s(e(J),{class:"size-3 ml-2"})]),_:1},8,["disabled","loading"])]),_:1},8,["onConfirm"])])):d.request.status==="now-playing"?(l(),g("div",et," Now "+f(d.request.type==="hype"?"performing hype":"playing"),1)):b("",!0)])}}}),st={key:0,class:"min-h-[350px]"},nt={class:"place-center grid place-items-center gap-2"},at={class:"size-12 rounded-full bg-white/40 relative"},ot={class:"text-xl text-muted-foreground font-medium"},G=U({__name:"request-list",props:{requests:{default:()=>P},onUpdate:{},type:{default:"song"},loading:{type:Boolean,default:!1}},setup(x){const m=i=>{i.preventDefault()};return(i,c)=>{const _=K,r=T,d=ee,u=te;return l(),q(u,null,{default:a(()=>[s(d,{class:"space-y-2 relative"},{default:a(()=>[(l(!0),g(E,null,M(i.requests,(n,o)=>(l(),q(_,{key:n.id,value:n.id,onSelect:m},{default:a(()=>[s(Oe,{request:n,class:"min-[880px]:hidden",index:o+1,onUpdate:i.onUpdate,"default-open":n.status==="now-playing",disabled:n.status==="now-playing"},null,8,["request","index","onUpdate","default-open","disabled"]),s(tt,{request:n,class:"hidden min-[880px]:grid",index:o+1,onUpdate:i.onUpdate},null,8,["request","index","onUpdate"])]),_:2},1032,["value"]))),128)),!i.requests.length&&!i.loading?(l(),g("div",st,[t("div",nt,[t("div",at,[s(r,{class:"scale-75 place-center",name:i.type=="song"?"music":"mic"},null,8,["name"])]),t("div",ot," No "+f(i.type)+" requests ",1),c[0]||(c[0]=t("div",{class:"text-muted-foreground"}," Get prepared, requests may come soon ",-1))])])):b("",!0)]),_:1})]),_:1})}}}),it={class:"grid md:grid-cols-[70px_1fr] gap-2 px-2 sm:px-6 py-4 b-white/5 rounded-2xl text-muted-foreground"},dt={class:"grid md:grid-cols-[1fr_200px] gap-2 items-center"},lt={class:"space-y-1"},rt={class:"flex gap-x-2 items-center"},ut={class:"text-base text-foreground font-medium"},pt={class:"text-sm"},ct={class:"flex gap-x- items-center"},mt={class:"flex items-center gap-x-1"},ft={class:"uppercase"},_t={class:"tabular-nums"},gt={class:"flex gap-x-1 md:justify-end items-center text-sm"},vt={class:"capitalize"},yt=U({__name:"request-history-line-item",props:{request:{},index:{},onUpdate:{type:Function}},setup(x){const m=x,{updateEventRequest:i,updating:c}=D(),_=r=>{i(m.request.id,r,m.onUpdate)};return(r,d)=>{const u=T,n=h;return l(),g("div",it,[t("div",null,f(("useDateFormat"in r?r.useDateFormat:e(we))(new Date(r.request.created_at),"h:mma")),1),t("div",dt,[t("div",lt,[t("div",rt,[r.request.type==="hype"?(l(),q(j,{key:0,content:r.request.description,class:"text-base text-foreground font-medium"},null,8,["content"])):(l(),g(E,{key:1},[t("div",ut,f(r.request.song_title),1),t("div",pt,"by "+f(r.request.artist),1)],64))]),t("div",ct,[t("div",null,f(r.request.nickname??r.request.audience.name),1),s(e(Y)),t("div",mt,[s(u,{class:"scale-50",name:r.request.type=="song"?"music":"mic"},null,8,["name"]),t("div",ft,f(r.request.type),1)]),s(e(Y)),t("div",_t,"₦"+f(("formatMoney"in r?r.formatMoney:e(F))(r.request.price)),1)])]),t("div",gt,[t("div",vt,f(r.request.status),1),["ignored","declined"].includes(r.request.status)?(l(),q(ne,{key:0,message:"Return to request list",delay:200},{default:a(()=>[s(n,{size:"icon",variant:"ghost",disabled:e(c),loading:e(c),onClick:d[0]||(d[0]=()=>_("new"))},{default:a(()=>[s(e(Ue),{class:"text-muted-foreground size-4"})]),_:1},8,["disabled","loading"])]),_:1})):b("",!0)])])])}}}),ht={key:0,class:"min-h-[350px]"},qt={class:"place-center grid place-items-center gap-2 text-center"},xt={class:"size-12 rounded-full bg-white/40 relative"},bt=U({__name:"request-history-list",props:{requests:{default:()=>P},onUpdate:{},loading:{type:Boolean,default:!1}},setup(x){const m=i=>{i.preventDefault()};return(i,c)=>{const _=K,r=T,d=ee,u=te;return l(),q(u,null,{default:a(()=>[s(d,{class:"space-y-2 relative"},{default:a(()=>[(l(!0),g(E,null,M(i.requests,n=>(l(),q(_,{key:n.id,value:n.id,onSelect:m},{default:a(()=>[s(yt,{request:n,onUpdate:i.onUpdate},null,8,["request","onUpdate"])]),_:2},1032,["value"]))),128)),!i.requests.length&&!i.loading?(l(),g("div",ht,[t("div",qt,[t("div",xt,[s(r,{class:"scale-75 place-center",name:"history"})]),c[0]||(c[0]=t("div",{class:"text-xl text-muted-foreground font-medium"}," Nothing yet ",-1)),c[1]||(c[1]=t("div",{class:"text-muted-foreground"}," Your completed/rejected requests will be here ",-1))])])):b("",!0)]),_:1})]),_:1})}}}),wt={class:"size-5 text-sm bg-secondary text-destructive rounded-full font-semibold count"},$t={class:"size-5 text-sm bg-secondary text-destructive rounded-full font-semibold count"},kt={class:"md:hidden"},Rt={key:2,class:"py-8 absolute inset-0 bg-white/5 rounded-[inherit] grid place-items-center z-10"},Ut={key:1,class:"grid place-items-center gap-y-4"},Ct={class:"text-destructive text-center"},zt=U({__name:"requests-tab",props:{requests:{default:()=>P},event_id:{default:"1"}},setup(x){const m=x,i=se(),c=k(()=>{var v;return(v=i==null?void 0:i.query)==null?void 0:v.request_tab}),_=k(()=>c.value??"song"),{fetchEventRequests:r}=D(),{data:d,status:u,error:n,refresh:o}=$e(`EVENT-${m.event_id}-REQUESTS`,()=>r(m.event_id),{transform:v=>{const p={"now-playing":0,new:1,"payment-pending":2,completed:3,declined:4,ignored:5};return v.data.sort((w,$)=>(p==null?void 0:p[w.status])-p[$.status])}}),y=k(()=>{var v;return!d.value||n.value?[]:(v=d.value)==null?void 0:v.filter(p=>p.status==="new"||p.status==="now-playing")}),C=k(()=>{var v;return!d.value||n.value?[]:(v=d.value)==null?void 0:v.filter(p=>p.status!=="new"&&p.status!=="now-playing")}),z=k(()=>y.value.filter(v=>v.type==="song")),L=k(()=>y.value.filter(v=>v.type==="hype"));return(v,p)=>{const w=xe,$=_e,S=ge,A=T,I=ve,oe=ye;return l(),q(oe,{class:"border bg-white/5 rounded-3xl relative","default-value":e(_)},{default:a(()=>{var O,H;return[e(_)==="history"?(l(),q(S,{key:0,class:"p-4 border-b grid grid-cols-[auto_1fr] gap-x-4 items-center min-h-[73px] transition-opacity duration-1000"},{default:a(()=>[p[2]||(p[2]=t("div",{class:"text-lg font-medium pl-6 hidden md:block"},"Request history",-1)),s($,{value:"song","as-child":""},{default:a(()=>[s(w,{replace:"",to:{query:{...e(i).query,request_tab:"song"}},class:"flex items-center gap-x-1 ml-auto pr-6"},{default:a(()=>[s(h,{variant:"outline",size:"icon"},{default:a(()=>[s(e(ie))]),_:1}),p[1]||(p[1]=t("div",null,"Back to live request",-1))]),_:1},8,["to"])]),_:1})]),_:1})):(l(),q(S,{key:1,class:"p-4 border-b grid grid-cols-[auto_auto_1fr] gap-x-4 items-center -z-10"},{default:a(()=>[s($,{value:"song","as-child":""},{default:a(()=>[s(w,{replace:"",to:{query:{...e(i).query,request_tab:"song"}},class:"[&[data-state='active']_.count]:hidden"},{default:a(()=>[s(h,{variant:e(_)==="song"?"primary":"outline",class:"gap-x-2 md:min-w-[100px]"},{default:a(()=>[p[3]||(p[3]=t("div",null,"song",-1)),t("div",wt,f(e(z).length),1)]),_:1},8,["variant"])]),_:1},8,["to"])]),_:1}),s($,{value:"hype","as-child":""},{default:a(()=>[s(w,{replace:"",to:{query:{...e(i).query,request_tab:"hype"}},class:"[&[data-state='active']_.count]:hidden"},{default:a(()=>[s(h,{variant:e(_)==="hype"?"primary":"outline",class:"gap-x-2 md:min-w-[100px]"},{default:a(()=>[p[4]||(p[4]=t("div",null,"hype",-1)),t("div",$t,f(e(L).length),1)]),_:1},8,["variant"])]),_:1},8,["to"])]),_:1}),s($,{value:"history","as-child":""},{default:a(()=>[s(w,{to:{query:{...e(i).query,request_tab:"history"}},replace:"",class:"ml-auto"},{default:a(()=>[s(h,{variant:"ghost",class:"gap-x-2 text-muted-foreground hidden md:inline-flex"},{default:a(()=>[s(A,{name:"history"}),p[5]||(p[5]=t("div",null,"Request history",-1))]),_:1}),t("div",kt,[s(ne,{message:"Request history"},{default:a(()=>[s(h,{variant:"ghost",size:"icon"},{default:a(()=>[s(A,{name:"history"})]),_:1})]),_:1})])]),_:1},8,["to"])]),_:1})]),_:1})),e(u)=="pending"||e(n)?(l(),g("div",Rt,[e(u)==="pending"?(l(),q(e(B),{key:0,class:"size-5 animate-spin"})):e(n)?(l(),g("div",Ut,[t("div",Ct,f(((H=(O=e(n))==null?void 0:O.data)==null?void 0:H.message)??"Failed to load request"),1),s(h,{variant:"secondary",onClick:p[0]||(p[0]=()=>e(o)())},{default:a(()=>p[6]||(p[6]=[R(" Retry ")])),_:1})])):b("",!0)])):b("",!0),e(n)?b("",!0):(l(),g(E,{key:3},[s(I,{value:"song"},{default:a(()=>[s(G,{type:"song",loading:e(u)==="pending",requests:e(z),onUpdate:e(o),class:"p-4"},null,8,["loading","requests","onUpdate"])]),_:1}),s(I,{value:"hype",class:"p-4"},{default:a(()=>[s(G,{type:"hype",loading:e(u)==="pending",requests:e(L),onUpdate:e(o)},null,8,["loading","requests","onUpdate"])]),_:1}),s(I,{value:"history",class:"p-4"},{default:a(()=>[s(bt,{loading:e(u)==="pending",requests:e(C),onUpdate:e(o)},null,8,["loading","requests","onUpdate"])]),_:1})],64))]}),_:1},8,["default-value"])}}}),Et={class:"container py-20"},Lt={class:"flex items-center gap-x-2"},St={class:"text-foreground font-medium text-lg"},At={class:"grid xl:grid-cols-[1fr_auto] items-start gap-4"},Dt={class:"xl:max-w-[900px]"},Nt={class:"max-w-[700px] mx-auto w-full xl:w-[380px] relative"},Tt={key:0,class:"absolute inset-0 grid place-items-center bg-background/40"},ts=U({__name:"index",setup(x){const m=se(),{endEvent:i,ending:c}=D(),{data:_,error:r,status:d,refresh:u}=ke(`/events/${m.params.id}`),n=()=>{i(m.params.id)},o=k(()=>{var C;return(C=m==null?void 0:m.query)==null?void 0:C.request_tab}),y=k(()=>m.params.id);return he({title:()=>o.value==="history"?"Request History":"Song and Hype Request List"}),(C,z)=>{var p,w,$;const L=de,v=le;return l(),g("div",null,[s(Re,{ending:e(c),onEndEvent:n,"start-date":(p=e(_))==null?void 0:p.data.start_date,animate:""},null,8,["ending","start-date"]),t("div",Et,[t("div",Lt,[s(L,{to:"/dashboard"}),t("div",St,f(($=(w=e(_))==null?void 0:w.data)==null?void 0:$.title),1)]),s(v,{error:e(r),class:"mt-8"},{default:a(()=>{var S,A;return[t("div",At,[t("div",Dt,[s(zt,{event_id:e(y)},null,8,["event_id"])]),t("div",Nt,[e(d)==="pending"?(l(),g("div",Tt,[s(e(B),{class:"size-5 animate-spin"})])):b("",!0),s(Se,{services:((A=(S=e(_))==null?void 0:S.data)==null?void 0:A.types)??[],onUpdate:e(u)},null,8,["services","onUpdate"]),s(V,{onConfirm:n,message:"Are you sure you want to end this event?"},{default:a(()=>[s(h,{class:"w-full mt-6",variant:"destructive",size:"lg",loading:e(c)},{default:a(()=>z[0]||(z[0]=[R(" END EVENT ")])),_:1},8,["loading"])]),_:1})])])]}),_:1},8,["error"])])])}}});export{ts as default};
